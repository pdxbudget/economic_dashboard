```{r}
data <- list()
data$fred <- list()
data$port <- list()
```

```{r, data_fred}

# This product uses the FREDÂ® API but is not endorsed or certified by the Federal Reserve Bank of St. Louis.

fredr_set_key(fredr_get_key())

get_fredr_series <- function(series_id, file_name) {
  
  # if FRED data was last modified last month (or before that),
  # fetch new data
  
  if (month(file.mtime(paste0("inputs/", file_name, ".rds"))) <
      month(today())) {
    params <- get("params")
    
    data <- map(series_id, fredr,
      observation_start = params$start_date,
      observation_end = params$end_date) %>%
      bind_rows()
    
    saveRDS(data, paste0("inputs/", file_name, ".rds"))
    
    return(data)
  } else {
    readRDS(paste0("inputs/", file_name, ".rds"))
  }
}
```

```{r, data_port}
# if port data was last modified last month (or before that),
# download new file

if (month(file.mtime("inputs/data_port.xlsx")) < month(today())) {
  download.file(
  "https://cdn.portofportland.com/pdfs/February%202022%20Statistics%20(Excel).xlsx", 
  destfile = "inputs/data_port.xlsx", mode = "wb")
}

data$port$passenger <- read_xlsx(
  "inputs/data_port.xlsx", sheet = "Passenger Traffic Report",
  skip = 5)
data$port$freight <- read_xlsx(
  "inputs/data_port.xlsx", sheet = "Freight Traffic Report",
  skip = 5)

data$port <- data$port %>%
  map(filter, Carrier %in% c("PDX Total", "PDX Total *")) %>%
  map(select, 5:7) # keep YTD columns only
```