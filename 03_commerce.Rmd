Commerce
=====================================  

Row {data-height=75}
-------------------------------------

```{r}
h3("Total Air Passengers")
```

Row
-------------------------------------

### Total Year-to-Date Air Passengers as of `r paste(month(params$end_date, label = TRUE), year(params$end_date))`

```{r air_passengers_month}
ytd <- data$port$passenger_historical %>%
  filter(Month <= params$end_date,
         Month >= floor_date(params$end_date, unit = "year")) %>%
  summarize(Passengers = sum(Passengers, na.rm = TRUE)) %>%
  pull("Passengers")

valueBox(
    format_number(ytd, accuracy = 1L),
    icon = "fa-plane")
```

### Year-over-Year Change

```{r air_passengers_yoy}

ytd_last <- data$port$passenger_historical %>%
  filter(Month <= params$end_date - years(1),
         Month >= floor_date(params$end_date, unit = "year") - years(1)) %>%
  summarize(Passengers = sum(Passengers, na.rm = TRUE)) %>%
  pull("Passengers")

valueBox(scales::percent(
  (ytd - ytd_last) / ytd_last, accuracy = 0.1),
         color = case_when(yoy > .01 ~ "success",
                           yoy < -.01 ~ "danger",
                           TRUE ~ "warning"))
```

Row {data-height=350}
-------------------------------------

### History

```{r air_passengers_history}
data$port$passenger_historical %>%
  mutate(Month = as.Date(Month)) %>%
make_plot(x = "Month", y = "Passengers")
```

Row {data-height=75}
-------------------------------------

```{r}
h3("Total Air Freight")
```

Row
-------------------------------------
### Total Air Freight as of March 2022 (YTD in Tons)

```{r}
valueBox(
  format_number(data$port$freight[[1]], accuracy = 1L), 
  icon = "fa-dolly")
```

Row {data-height=75}
-------------------------------------

```{r}
h3("Total Marine Freight")
```

Row
-------------------------------------

### Total Tonnage as of Mar 2022 (YTD)
```{r}
valueBox(
  format_number(tail(data$port$marine$`Total Tonnage`, n=1) , accuracy = 1L), 
  icon = "fa-dolly")
```

Row {data-height=350}
-------------------------------------
### History

```{r}
  ggplotly(
    data$port$marine %>%
      ggplot(aes(x = Date, y = `Total Tonnage`)) +
      geom_line() +
      scale_y_continuous(labels = comma) +
      scale_x_date(date_breaks = "3 months" , date_labels = "%b %Y") +
      scale_color_viridis(discrete = TRUE) +
      theme_minimal() +
      theme(axis.text.x = element_text(angle = 45),
            axis.title.x = element_blank()))
```

### Context

We will explain this here